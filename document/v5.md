# ğŸ’» Migrating to TanStack Query(React) v5

## ğŸ“„ ì£¼ìš” ë³€ë™ ì‚¬í•­ (â­ï¸ ì¤‘ìš”)

### 1. â­ï¸ Supports a single signature, one object

- `useQuery`, `useInfiniteQuery`, `useMutation`ì´ ì´ì œëŠ” ê°ì²´ í˜•ì‹ë§Œ ì§€ì›í•˜ë„ë¡ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
- v4ì—ì„œëŠ” `useQuery(key, fn, options)`, `useQuery({ queryKey, queryFn, ...options })` ë‘ í˜•íƒœë¥¼ ëª¨ë‘ ì§€ì›í–ˆëŠ”ë° ì´ëŠ” ìœ ì§€ë³´ìˆ˜ê°€ í˜ë“¤ê³ , ë§¤ê°œ ë³€ìˆ˜ íƒ€ì…ì„ í™•ì¸í•˜ê¸° ìœ„í•œ ëŸ°íƒ€ì„ ê²€ì‚¬ë„ í•„ìš”í–ˆê¸° ë•Œë¬¸ì— ì˜¤ë¡œì§€ `ê°ì²´`` í˜•ì‹ë§Œ ì§€ì›í•˜ë„ë¡ v5ì—ì„œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```diff
- useQuery(key, fn, options)
+ useQuery({ queryKey, queryFn, ...options })
- useInfiniteQuery(key, fn, options)
+ useInfiniteQuery({ queryKey, queryFn, ...options })
- useMutation(fn, options)
+ useMutation({ mutationFn, ...options })
- useIsFetching(key, filters)
+ useIsFetching({ queryKey, ...filters })
- useIsMutating(key, filters)
+ useIsMutating({ mutationKey, ...filters })
```

```diff
- queryClient.isFetching(key, filters)
+ queryClient.isFetching({ queryKey, ...filters })
- queryClient.ensureQueryData(key, filters)
+ queryClient.ensureQueryData({ queryKey, ...filters })
- queryClient.getQueriesData(key, filters)
+ queryClient.getQueriesData({ queryKey, ...filters })
- queryClient.setQueriesData(key, updater, filters, options)
+ queryClient.setQueriesData({ queryKey, ...filters }, updater, options)
- queryClient.removeQueries(key, filters)
+ queryClient.removeQueries({ queryKey, ...filters })
- queryClient.resetQueries(key, filters, options)
+ queryClient.resetQueries({ queryKey, ...filters }, options)
- queryClient.cancelQueries(key, filters, options)
+ queryClient.cancelQueries({ queryKey, ...filters }, options)
- queryClient.invalidateQueries(key, filters, options)
+ queryClient.invalidateQueries({ queryKey, ...filters }, options)
- queryClient.refetchQueries(key, filters, options)
+ queryClient.refetchQueries({ queryKey, ...filters }, options)
- queryClient.fetchQuery(key, fn, options)
+ queryClient.fetchQuery({ queryKey, queryFn, ...options })
- queryClient.prefetchQuery(key, fn, options)
+ queryClient.prefetchQuery({ queryKey, queryFn, ...options })
- queryClient.fetchInfiniteQuery(key, fn, options)
+ queryClient.fetchInfiniteQuery({ queryKey, queryFn, ...options })
- queryClient.prefetchInfiniteQuery(key, fn, options)
+ queryClient.prefetchInfiniteQuery({ queryKey, queryFn, ...options })
```

```diff
- queryCache.find(key, filters)
+ queryCache.find({ queryKey, ...filters })
- queryCache.findAll(key, filters)
+ queryCache.findAll({ queryKey, ...filters })
```

<br />

### 2. â­ï¸ 'queryClient.getQueryData', 'queryClient.getQueryState' now accepts queryKey only as an Argument

- `queryClient.getQueryData`ì˜ ì¸ìˆ˜ê°€ `queryKey`ë§Œ ë°›ë„ë¡ v5ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

```diff
- queryClient.getQueryData(queryKey, filters)
+ queryClient.getQueryData(queryKey)
```

- ë§ˆì°¬ê°€ì§€ë¡œ `queryClient.getQueryState`ë„ ì¸ìˆ˜ê°€ `queryKey`ë§Œ ë°›ë„ë¡ v5ì—ì„œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.

```diff
- queryClient.getQueryState(queryKey, filters)
+ queryClient.getQueryState(queryKey)
```

<br />

### 3. â­ï¸ Callbacks on useQuery (and QueryObserver) have been removed

- useQueryì˜ ì˜µì…˜ì¸ `onSuccess`, `onError`, `onSettled`ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
  - í•´ë‹¹ ì½œë°± í•¨ìˆ˜ë“¤ì€ ê°„ë‹¨í•˜ê³ , ì§ê´€ì ì´ë¼ êµ‰ì¥íˆ ìœ ìš©í•˜ì§€ë§Œ ë²„ê·¸ë¥¼ ìœ ë°œ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ìì„¸í•œ ë‚´ìš©ì€ Tanstack Query maintainerì¸ [tkdodo ë¸”ë¡œê·¸ í¬ìŠ¤íŒ…](https://tkdodo.eu/blog/breaking-react-querys-api-on-purpose)ì„ ì°¸ê³ í•´ì£¼ì‹œê¸° ë°”ëë‹ˆë‹¤.

<br />

### 4. The 'remove' method has been removed from useQuery

- useQueryì˜ `remove` ë©”ì„œë“œê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤. ì´ì „ì—ëŠ” `remove` ë©”ì„œë“œëŠ” observerì—ê²Œ ì•Œë¦¬ì§€ ì•Šê³  ì¿¼ë¦¬ë¥¼ queryCacheì—ì„œ ì œê±°í•˜ëŠ”ë° ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
  - ì˜ˆë¥¼ ë“¤ì–´, ì‚¬ìš©ìë¥¼ ë¡œê·¸ì•„ì›ƒ í•  ë•Œì™€ ê°™ì´ ë” ì´ìƒ í•„ìš”í•˜ì§€ ì•Šì€ ë°ì´í„°ë¥¼ ì œê±°í•  ë•Œì™€ ê°™ì€ ê²½ìš°ì— í™œìš© í•  ìˆ˜ ìˆëŠ” ë©”ì„œë“œì˜€ìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ, queryê°€ ì•„ì§ í™œì„±í™”ëœ ìƒíƒœì—ì„œ ì´ `remove` ë©”ì„œë“œë¥¼ í˜¸ì¶œí•˜ëŠ” ê²ƒì€ ë‹¤ìŒ ë²ˆ ë¦¬ë Œë”ë§ í•  ë•Œ `hard loading ìƒíƒœ`ë¥¼ íŠ¸ë¦¬ê±°í•˜ê¸° ë•Œë¬¸ì— í•©ë¦¬ì ì´ì§€ ëª»í•©ë‹ˆë‹¤.

  - ì—¬ê¸°ì„œ, `hard loading ìƒíƒœ`ë€? ë°ì´í„°ê°€ ì—†ëŠ” ì¦‰, ì´ˆê¸° ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ë•Œ ë¡œë”© ìƒíƒœë¥¼ ë§í•©ë‹ˆë‹¤.
  - useQueryì—ì„œ ìì£¼ ì‚¬ìš©í•˜ëŠ” `isLoading`ì´ ì´ëŸ° `hard loading ìƒíƒœ`ì¸ ê²½ìš°ì—ë§Œ `ì°¸(true)`ì…ë‹ˆë‹¤.
  - [When we refetch a query, it doesn't set isLoading true.](https://github.com/TanStack/query/issues/2559#issuecomment-896622341)

- í•˜ì§€ë§Œ!! ê·¸ëŸ¼ì—ë„ ë¶ˆêµ¬í•˜ê³  ì¿¼ë¦¬ë¥¼ ì œê±°í•´ì•¼ ëœë‹¤ë©´ `queryClient.removeQueries`ë¥¼ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.

```diff
const queryClient = useQueryClient();
const query = useQuery({ queryKey, queryFn });
- query.remove()
+ queryClient.removeQueries({ queryKey })
```

<br />

### 5. The 'isDataEqual' option has been removed from useQuery

- `isDataEqual` í•¨ìˆ˜ëŠ” queryì—ì„œ resolvedëœ ë°ì´í„°ë¡œì„œ ì´ì „ ë°ì´í„°ë¥¼ ì‚¬ìš©í• ì§€ ì•„ë‹ˆë©´ ìƒˆ ë°ì´í„°ë¥¼ ì‚¬ìš©í• ì§€ í™•ì¸í•˜ëŠ”ë° ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.
- ì´ì œëŠ” `isDataEqual`ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ë™ì¼í•œ ê¸°ëŠ¥ìœ¼ë¡œì„œ `structuralSharing`ìœ¼ë¡œ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff
import { replaceEqualDeep } from '@tanstack/react-query'

- isDataEqual: (oldData, newData) => customCheck(oldData, newData)
+ structuralSharing: (oldData, newData) => customCheck(oldData, newData) ? oldData : replaceEqualDeep(oldData, newData)
```

<br />

### 6. â­ï¸ Rename 'cacheTime' to 'gcTime'

- `cacheTime`ì´ `gcTime`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.
  - ë„¤ì´ë°ì´ ë³€ê²½ëœ ì´ìœ ëŠ” ë§ì€ ì‚¬ëŒë“¤ì´ `cacheTime`ì„ ë§ˆì¹˜ "ë°ì´í„°ê°€ ìºì‹œë˜ëŠ” ì‹œê°„"ìœ¼ë¡œ ì°©ê°í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
  - í•˜ì§€ë§Œ, ì‹¤ì œë¡œ queryê°€ ê³„ì† ì‚¬ìš©ë˜ëŠ” í•œ`cacheTime`ì€ ì•„ë¬´ ì¼ë„ í•˜ì§€ ì•Šê³ , queryê°€ ë”ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•ŠëŠ” ì‹œì ì— ì‹œì‘ë©ë‹ˆë‹¤. ê·¸ë¦¬ê³  `cacheTime` ì‹œê°„ì´ ì§€ë‚˜ë©´ ìºì‹œê°€ ë”ì´ìƒ ì»¤ì§€ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ë°ì´í„°ëŠ” `garbage collected`ë©ë‹ˆë‹¤.
- ë”°ë¼ì„œ, ì˜ë¯¸ìƒì˜ í˜¼ë™ì„ ì¤„ì´ê¸° ìœ„í•´ `cacheTime`ì—ì„œ `gcTime`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```diff
const MINUTE = 1000 * 60;

const queryClient = new QueryClient({
  defaultOptions: {
    queries: {
-      cacheTime: 10 * MINUTE,
+      gcTime: 10 * MINUTE,
    },
  },
})
```

<br />

### 7. â­ï¸ The 'useErrorBoundary' option has been renamed to 'throwOnError'

- ê¸°ì¡´ì— `ErrorBoundary`ì— ì—ëŸ¬ë¥¼ ë˜ì§€ê¸° ìœ„í•´ ì‚¬ìš©í–ˆë˜ ì˜µì…˜ì¸ `useErrorBoundary`ë¥¼ íŠ¹ì • í”„ë ˆì„ì›Œí¬ì— ì¢…ì†ë˜ì§€ ì•Šìœ¼ë©´ì„œ, ë¦¬ì•¡íŠ¸ ì»¤ìŠ¤í…€ í›…ì˜ ì ‘ë¯¸ì‚¬ì¸ `use`ì™€ `ErrorBoundary` ì»´í¬ë„ŒíŠ¸ëª…ê³¼ í˜¼ë™ì„ í”¼í•˜ê¸° ìœ„í•´, `throwOnError`ë¡œ ë³€ê²½ëìŠµë‹ˆë‹¤.

```diff
const todos = useQuery({
  queryKey: ['todos'],
  queryFn: fetchTodos,
-  useErrorBoundary: true,
+  throwOnError: true,
})
```

<br />

### 8. â­ï¸ TypeScript: 'Error' is now the default type for errors instead of 'unknown'

- v5 ë¶€í„°ëŠ” errorì˜ ê¸°ë³¸ íƒ€ì…ì´ `Error` ì…ë‹ˆë‹¤. ë³€ê²½ëœ ì´ìœ ëŠ” ë§ì€ ì‚¬ìš©ìë“¤ì´ ê¸°ëŒ€í•˜ëŠ” ê²°ê³¼ì´ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

```tsx
// const error: Error
const { error } = useQuery({
  queryKey: ["groups"],
  queryFn: fetchGroups,
});
```

- ë§Œì•½ `ì»¤ìŠ¤í…€ ì—ëŸ¬`ë¥¼ í™œìš©í•˜ê±°ë‚˜ `Error`ê°€ ì•„ë‹Œ ê²ƒì„ í™œìš©í•˜ê³  ì‹¶ë‹¤ë©´, ì•„ë˜ ì˜ˆì œì²˜ëŸ¼ íƒ€ì…ì„ êµ¬ì²´í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
// const error: string | null
const { error } = useQuery<Group[], string>({
  queryKey: ["groups"],
  queryFn: fetchGroups,
});
```

<br />

### 9. â­ï¸ Removed 'keepPreviousData' in favor of 'placeholderData' identity function

- â€‹`keepPreviousData` ì˜µì…˜ê³¼ `isPreviousData` í”Œë˜ê·¸ê°€ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
  - ì™œëƒí•˜ë©´ ì´ë“¤ì€ ê°ê° `placeholderData`ì™€ `isPlaceholderData í”Œë˜ê·¸ì™€ ê±°ì˜ ìœ ì‚¬í•˜ê²Œ ë™ì‘í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.
- ì•„ë˜ ì˜ˆì œëŠ” `placeholderData`ë¥¼ í™œìš©í•˜ë©´ì„œ ì´ì „ì— `keepPreviousData` ì˜µì…˜ì„ `true`ë¡œ ì¤¬ì„ë•Œì™€ ë™ì¼í•œ ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ê¸° ìœ„í•´ `identity function`ì„ í—ˆìš©í•˜ëŠ” `placeholderData`ì— Tanstack Queryì— í¬í•¨ëœ `keepPreviousData` í•¨ìˆ˜ë¥¼ ì¶”ê°€í•˜ì˜€ìŠµë‹ˆë‹¤.

```diff
import {
   useQuery,
+  keepPreviousData
} from "@tanstack/react-query";

const {
   data,
-  isPreviousData,
+  isPlaceholderData,
} = useQuery({
  queryKey,
  queryFn,
- keepPreviousData: true,
+ placeholderData: keepPreviousData
});
```

- ë˜ëŠ”, ì§ì ‘ `identity function`ì„ ì œê³µí•˜ëŠ” ë°©ë²•ë„ ìˆìŠµë‹ˆë‹¤.

```tsx
useQuery({
  queryKey,
  queryFn,
  placeholderData: (previousData, previousQuery) => previousData,
  // identity function with the same behaviour as `keepPreviousData`
});
```

- ì—¬ê¸°ì„œ ìœ„ ë³€ê²½ì‚¬í•­ì—ëŠ” ëª‡ ê°€ì§€ ì£¼ì˜ì‚¬í•­ì´ ìˆìŠµë‹ˆë‹¤.

  - `placeholderData`ëŠ” í•­ìƒ `success` ìƒíƒœë¥¼ ìœ ì§€í•˜ë©°, keepPreviousDataëŠ” ì´ì „ ì¿¼ë¦¬ ìƒíƒœë¥¼ ì•Œë ¤ì¤ë‹ˆë‹¤. ë°ì´í„°ë¥¼ ì„±ê³µì ìœ¼ë¡œ ê°€ì ¸ì˜¨ í›„ `background refetch error`ê°€ ë°œìƒí•˜ë©´ `placeholderData`ì˜ `success` ìƒíƒœëŠ” ì˜¤ë¥˜ë¼ê³  ëŠë‚„ ìˆ˜ ìˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì—ëŸ¬ ìì²´ê°€ ê³µìœ ë˜ì§€ ì•Šê¸° ë•Œë¬¸ì— `placeholderDataì˜` ë™ì‘ì€ ê·¸ëŒ€ë¡œ ìœ ì§€í•˜ê¸°ë¡œ ê²°ì •ëìŠµë‹ˆë‹¤.

  - `keepPreviousData`ë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” ì´ì „ ë°ì´í„°ì˜ `dateUpdatedAt` íƒ€ì„ ìŠ¤íƒ¬í”„ê°€ ì œê³µë˜ì—ˆëŠ”ë°, `placeholderData`ë¥¼ ì‚¬ìš©í•˜ë©´ `dateUpdatedAt`ì€ `0`ìœ¼ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.

  - ë§Œì•½, íƒ€ì„ìŠ¤íƒ¬í”„ë¥¼ í™”ë©´ì— ê³„ì† ë³´ì—¬ì£¼ê³  ì‹¶ë‹¤ë©´ ì´ëŸ° ë™ì‘ì´ ë¶ˆë§Œì¡±ìŠ¤ëŸ¬ìš¸ ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ëŸ¬í•œ ë¬¸ì œëŠ” ì•„ë˜ì™€ ê°™ì´ `useEffect`ë¥¼ í™œìš©í•˜ë©´ í•´ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const [updatedAt, setUpdatedAt] = useState(0);

const { data, dataUpdatedAt } = useQuery({
  queryKey: ["projects", page],
  queryFn: () => fetchProjects(page),
});

useEffect(() => {
  if (dataUpdatedAt > updatedAt) {
    setUpdatedAt(dataUpdatedAt);
  }
}, [dataUpdatedAt]);
```

<br />

### 10. â­ï¸ Window focus refetching no longer listens to the 'focus' event

- Tanstack QueryëŠ” `visibilitychange` ì´ë²¤íŠ¸ë¥¼ ì§€ì›í•˜ëŠ” ë¸Œë¼ìš°ì €ë§Œ ì§€ì›í•˜ë„ë¡ ê²°ì •ëìŠµë‹ˆë‹¤. ë”°ë¼ì„œ, ì´ì œ `visibilitychange` ì´ë²¤íŠ¸ë§Œ ë…ì ì ìœ¼ë¡œ ì‚¬ìš©ë©ë‹ˆë‹¤.
- ì´ë¥¼ í†µí•´ ë‹¤ìŒ [focus ê´€ë ¨ ë¬¸ì œ](https://github.com/TanStack/query/pull/4805)ê°€ í•´ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.

<br />

### 11. Removed custom 'context' prop in favor of custom 'queryClient' instance

- ì»¤ìŠ¤í…€ queryClient ì¸ìŠ¤í„´ìŠ¤ë¥¼ ìœ„í•´ ì»¤ìŠ¤í…€ `context` propì´ ì œê±°ë˜ì—ˆìŠµë‹ˆë‹¤.
- ê¸°ì¡´ v4ì—ì„œëŠ” `context`ë¥¼ ëª¨ë“  react query hooksì— ì „ë‹¬í•  ìˆ˜ ìˆëŠ” ë°©ë²•ì„ ì œê³µí–ˆìŠµë‹ˆë‹¤. ì´ëŠ” `MicroFrontends`ë¥¼ ì‚¬ìš©í•  ë•Œ ì ì ˆí•˜ê²Œ ê²©ë¦¬í•  ìˆ˜ ìˆê²Œ í–ˆìŠµë‹ˆë‹¤.
- í•˜ì§€ë§Œ, ë‹¤ë“¤ ì•Œë‹¤ì‹¶ì´ `context`ëŠ” ë¦¬ì•¡íŠ¸ì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•œ ê¸°ëŠ¥ì…ë‹ˆë‹¤. `context`ëŠ” que`ryClientì— ëŒ€í•œ ì ‘ê·¼ ê¶Œí•œì„ ì£¼ëŠ” ì—­í• ì„ í•  ë¿ì…ë‹ˆë‹¤.
- v5ì—ì„œëŠ” ìœ„ì™€ ë™ì¼í•œ ê¸°ëŠ¥ì„ ì•„ë˜ ì˜ˆì œì²˜ëŸ¼ ì»¤ìŠ¤í…€ queyClientë¥¼ `ì§ì ‘` ì „ë‹¬í•¨ìœ¼ë¡œì¨ í•´ê²°í–ˆìŠµë‹ˆë‹¤. ì´ì œëŠ” ì–´ë–¤ ë‹¤ë¥¸ í”„ë ˆì„ì›Œí¬ì— êµ¬ì• ë°›ì§€ ì•Šê³  ë™ì¼í•œ ê¸°ëŠ¥ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```diff
import { queryClient } from './my-client'

const { data } = useQuery(
  {
    queryKey: ['users', id],
    queryFn: () => fetch(...),
-   context: customContext
  },
+  queryClient,
)
```

<br />

### 12. â­ï¸ Removed 'refetchPage' in favor of 'maxPages'

- `maxPages`ë¥¼ ìœ„í•´ `refetchpage`ë¥¼ ì œê±°í•˜ì˜€ìŠµë‹ˆë‹¤.
- v4ì—ì„œëŠ” `refetchPage` í•¨ìˆ˜ë¥¼ ì‚¬ìš©í•˜ì—¬ infinite queriesì— ëŒ€í•´ refresh í•  í˜ì´ì§€ë¥¼ ì •ì˜í•  ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ ì œê³µí–ˆìŠµë‹ˆë‹¤.
- ê·¸ëŸ¬ë‚˜ ëª¨ë“  í˜ì´ì§€ë¥¼ refresh í•˜ë©´ UI ë¶ˆì¼ì¹˜ê°€ ë°œìƒí•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ë˜í•œ ì´ ì˜µì…˜ì€ `queryClient.refetchQueries`ì—ì„œ ì‚¬ìš©í•  ìˆ˜ ìˆì§€ë§Œ `nomal queries`ê°€ ì•„ë‹Œ `infinite queries`ì—ëŒ€í•´ì„œë§Œ ë™ì‘í•©ë‹ˆë‹¤.
- v5ì—ì„œëŠ” `query data`ë¥¼ ì €ì¥í•˜ê³ , ë‹¤ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” í˜ì´ì§€ ìˆ˜ë¥¼ ì œí•œí•˜ëŠ” `infinite queries`ë¥¼ ìœ„í•œ ìƒˆë¡œìš´ `maxPages` ì˜µì…˜ì´ í¬í•¨ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

```tsx
useInfiniteQuery({
  queryKey: ["projects"],
  queryFn: fetchProjects,
  initialPageParam: 0,
  getNextPageParam: (lastPage, pages) => lastPage.nextCursor,
  getPreviousPageParam: (firstPage, pages) => firstPage.prevCursor,
  maxPages: 3,
});
```

- `infinite queries`ëŠ” ë§ì€ í˜ì´ì§€ë¥¼ ê°€ì ¸ì˜¬ìˆ˜ë¡ ë” ë§ì€ ë©”ëª¨ë¦¬ë¥¼ ì‚¬ìš©í•˜ê²Œ ë˜ë©°, ëª¨ë“  í˜ì´ì§€ë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ë‹¤ì‹œ ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì— `query refetching` í”„ë¡œì„¸ìŠ¤ë„ ëŠë ¤ì§‘ë‹ˆë‹¤.
- `maxPages`ë¥¼ í™œìš©í•˜ë©´ í˜ì´ì§€ ìˆ˜ë¥¼ ì œí•œí•˜ê³  ì´í›„ì— ë‹¤ì‹œ ê°€ì ¸ì˜¬ ìˆ˜ ìˆê¸° ë•Œë¬¸ì— ì´ëŸ° ë‹¨ì ì„ ë³´ì™„í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì°¸ê³ ë¡œ `infinite list`ëŠ” `ì–‘ë°©í–¥`ì´ì—¬ì•¼ í•˜ê¸° ë•Œë¬¸ì— ìœ„ ì˜ˆì œì²˜ëŸ¼ `getNextPageParam`ê³¼ `getPreviousPageParam`ì„ ëª¨ë‘ ì •ì˜í•´ì•¼ í•œë‹¤ëŠ” ì ì„ ì£¼ì˜í•´ì•¼ í•©ë‹ˆë‹¤.

<br />

### 13. â­ï¸ infinite queries now need a 'initialPageParam'

- ì´ì „ì—ëŠ” `undefined` ê°’ì„ ê°€ì§„ `pageParam`ì„ `queryFn`ì— ì „ë‹¬í–ˆê³ , `queryFn`ì—ì„œ `pageParam`ì— ëŒ€í•œ ê¸°ë³¸ ê°’ì„ ì •ì˜í–ˆìŠµë‹ˆë‹¤. í•˜ì§€ë§Œ ì´ëŸ° ê²½ìš° ì§ë ¬í™” í•  ìˆ˜ ì—†ëŠ” ì¿¼ë¦¬ ìºì‹œì— `undefined`ì¸ ìƒíƒœë¡œ ì €ì¥ëœë‹¤ëŠ” ë‹¨ì ì´ ìˆìŠµë‹ˆë‹¤.
- v5ë¶€í„°ëŠ” ì•„ë˜ ì˜ˆì œì²˜ëŸ¼ `infinite Query` ì˜µì…˜ì— ëª…ì‹œì ì¸ `initialPageParam`ì„ ì „ë‹¬í•´ì•¼ í•©ë‹ˆë‹¤.

```diff
useInfiniteQuery({
   queryKey,
-  queryFn: ({ pageParam = 0 }) => fetchSomething(pageParam),
+  queryFn: ({ pageParam }) => fetchSomething(pageParam),
+  initialPageParam: 0,
   getNextPageParam: (lastPage) => lastPage.next,
})
```

<br />

### 14. Manual mode for infinite queries has been removed

- ì´ì „ì—ëŠ” ì•„ë˜ ì˜ˆì œì²˜ëŸ¼ `pageParams` ê°’ì„ ìˆ˜ë™ì ìœ¼ë¡œ `fetchNextPage` ë˜ëŠ” `fetchPreviousPage`ì— ì§ì ‘ ì „ë‹¬í•˜ì—¬ `getNextPageParam` ë˜ëŠ” `getPreviousPageParam`ì—ì„œ ë°˜í™˜ë˜ëŠ” `pageParam`ë¥¼ ë®ì–´ì“°ëŠ” ê²ƒì´ í—ˆìš©ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
// v4
function Projects() {
  const fetchProjects = ({ pageParam = 0 }) =>
    fetch("/api/projects?cursor=" + pageParam);

  const {
    status,
    data,
    isFetching,
    isFetchingNextPage,
    fetchNextPage,
    hasNextPage,
  } = useInfiniteQuery({
    queryKey: ["projects"],
    queryFn: fetchProjects,
    getNextPageParam: (lastPage, pages) => lastPage.nextCursor,
  });

  // Pass your own page param
  const skipToCursor50 = () => fetchNextPage({ pageParam: 50 });
}
```

- í•˜ì§€ë§Œ ì´ `pageParam`ì„ ë®ì–´ì“°ëŠ” ê¸°ëŠ¥ì€ `refetch`ì—ì„œëŠ” ì „í˜€ ì‘ë™í•˜ì§€ ì•Šì•˜ê³ , ë§ì€ ì‚¬ëŒë“¤ì´ ì‚¬ìš©í•˜ëŠ” ê¸°ëŠ¥ì´ ì•„ë‹ˆì˜€ìŠµë‹ˆë‹¤. ì¦‰, `infinite queries`ì—ì„œ `getNextPageParam`ì´ í•„ìˆ˜ì ì„ì„ ì˜ë¯¸í•©ë‹ˆë‹¤.

<br />

### 15. â­ï¸ Returning 'null' from 'getNextPageParam' or 'getPreviousPageParam' now indicates that there is no further page available

- v4ì—ì„œëŠ” ë” ì´ìƒ í˜ì´ì§€ ì—†ìŒì„ ë‚˜íƒ€ë‚´ê¸° ìœ„í•´ ëª…ì‹œì ìœ¼ë¡œ `undefined`ë¥¼ ë°˜í™˜í•´ì•¼ í–ˆìŠµë‹ˆë‹¤. v5ë¶€í„°ëŠ” `undefined` ë¿ë§Œ ì•„ë‹ˆë¼ `null`ê¹Œì§€ í¬í•¨í•˜ë„ë¡ í™•ì¥ëìŠµë‹ˆë‹¤.

```tsx
getNextPageParam: (lastPage, allPages, lastPageParam, allPageParams) =>
  TPageParam | undefined | null;

getPreviousPageParam: (firstPage, allPages, firstPageParam, allPageParams) =>
  TPageParam | undefined | null;
```

<br />

### 16. No retries on the server

- ì„œë²„ì—ì„œ retryì˜ ê¸°ë³¸ ê°’ì€ `3`ì´ ì•„ë‹Œ `0`ì…ë‹ˆë‹¤.
- `prefetching`ì˜ ê²½ìš° í•­ìƒ ê¸°ë³¸ê°’ì´ 0ì´ì˜€ì§€ë§Œ, `suspense`ê°€ í™œì„±í™”ëœ ì¿¼ë¦¬ëŠ” ì´ì œ ì„œë²„ì—ì„œë„ ì§ì ‘ ì‹¤í–‰í•  ìˆ˜ ìˆê¸° ë•Œë¬¸ì—(React v18 ì´í›„) ì„œë²„ì—ì„œ ì¬ì‹œë„ë¥¼ ì „í˜€ í•˜ì§€ ì•Šë„ë¡ í•´ì•¼í•©ë‹ˆë‹¤.

<br />

### 17. â­ï¸ 'status: loading' has been changed to 'status: pending' and 'isLoading' has been changed to 'isPending' and 'isInitialLoading' has now been renamed to 'isLoading'

- `loading` ì˜µì…˜ì´ `pending`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìœ¼ë©°, ë§ˆì°¬ê°€ì§€ë¡œ `isLoading` í”Œë˜ê·¸ê°€ `isPending`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
isPending: boolean;
// A derived boolean from the status variable above, provided for convenience.
isSuccess: boolean;
// A derived boolean from the status variable above, provided for convenience.
isError: boolean;
// A derived boolean from the status variable above, provided for convenience.
```

- `mutation`ì˜ ê²½ìš°ì—ë„ `isLoading` í”Œë˜ê·¸ê°€ `isPending`ìœ¼ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.

```tsx
status: string;
/*
  Will be:
    - 'idle' initial status prior to the mutation function executing.
    - 'pending' if the mutation is currently executing.
    - 'error' if the last mutation attempt resulted in an error.
    - 'success' if the last mutation attempt was successful.
  'isIdle', 'isPending', 'isSuccess', 'isError': boolean variables derived from 'status'
 */
```

- ê·¸ë¦¬ê³  `isPending && isFetching`ìœ¼ë¡œ êµ¬í˜„ë˜ëŠ” ìƒˆë¡œìš´ `isLoading` í”Œë˜ê·¸ê°€ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.
- ì´ëŠ” ê¸°ì¡´ì˜ `isInitialLoading`ê³¼ ë™ì¼í•œ ê¸°ëŠ¥ì„ í•˜ëŠ”ë°, `isInitialLoading`ì€ ë” ì´ìƒ ì‚¬ìš©ë˜ì§€ ì•Šìœ¼ë©° ë‹¤ìŒ ë©”ì´ì € ë²„ì „ ì—…ë°ì´íŠ¸ì—ì„œ ì œê±°ë  ì˜ˆì •ì…ë‹ˆë‹¤.

<br />

### 18. Simplified optimistic updates

- v5ë¶€í„°ëŠ” ë‚™ê´€ì  ì—…ë°ì´íŠ¸ë¥¼ ìˆ˜í–‰í•˜ëŠ” ë‹¨ìˆœí•œ ë°©ë²•ì„ ì œê³µí•©ë‹ˆë‹¤.

```tsx
const queryInfo = useTodos();
const addTodoMutation = useMutation({
  mutationFn: (newTodo: string) => axios.post("/api/data", { text: newTodo }),
  onSettled: () => queryClient.invalidateQueries({ queryKey: ["todos"] }),
});

if (queryInfo.data) {
  return (
    <ul>
      {queryInfo.data.items.map((todo) => (
        <li key={todo.id}>{todo.text}</li>
      ))}
      {addTodoMutation.isPending && (
        <li key={String(addTodoMutation.submittedAt)} style={{ opacity: 0.5 }}>
          {addTodoMutation.variables}
        </li>
      )}
    </ul>
  );
}
```

- ìœ„ ì˜ˆì œì—ì„œëŠ” ë°ì´í„°ë¥¼ ìºì‹œì— ì§ì ‘ ì“°ëŠ” ëŒ€ì‹ ì— `mutation`ì´ ì‹¤í–‰ì¤‘ì¼ ë•Œ UIê°€ í‘œì‹œë˜ëŠ” ë°©ì‹ë§Œ ë³€ê²½í•©ë‹ˆë‹¤. í•´ë‹¹ ë°©ë²•ì€ `ë‚™ê´€ì  ì—…ë°ì´íŠ¸`ë¥¼ í‘œì‹œí•´ì•¼ í•˜ëŠ” ìœ„ì¹˜ê°€ í•œ ê³³ë§Œ ìˆëŠ” ê²½ìš°ì— íš¨ê³¼ì ì…ë‹ˆë‹¤.
- `ë‚™ê´€ì  ì—…ë°ì´íŠ¸`ì™€ ê´€ë ¨ëœ ìì„¸í•œ ë‚´ìš©ì€ [optimistic-updates](https://tanstack.com/query/v5/docs/react/guides/optimistic-updates)ë¥¼ ì°¸ê³ í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

<br />

### 19. Infinite Queries can prefetch multiple Pages

- ì´ì œ `infinite queries`ë„ `normal queries`ì²˜ëŸ¼ `prefetch` í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- ê¸°ë³¸ì ìœ¼ë¡œ `query`ì˜ ì²« ë²ˆì§¸ í˜ì´ì§€ë§Œ `prefetch`ë˜ë©° ì§€ì •ëœ `queryKey` ì•„ë˜ì— ì €ì¥ë©ë‹ˆë‹¤. ë‘ ê°œ ì´ìƒì˜ í˜ì´ì§€ë¥¼ ë¯¸ë¦¬ ê°€ì ¸ì˜¤ë ¤ë©´ `pages` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ ë©ë‹ˆë‹¤.
- `prefetch`ì™€ ê´€ë ¨ëœ ìì„¸í•œ ë‚´ìš©ì€ [prefetching](https://tanstack.com/query/v5/docs/react/guides/prefetching)ë¥¼ ì°¸ê³ í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

```tsx
const prefetchTodos = async () => {
  // The results of this query will be cached like a normal query
  await queryClient.prefetchInfiniteQuery({
    queryKey: ["projects"],
    queryFn: fetchProjects,
    initialPageParam: 0,
    getNextPageParam: (lastPage, pages) => lastPage.nextCursor,
    pages: 3, // prefetch the first 3 pages
  });
};
```

<br />

### 20. new 'combine' option for 'useQueries'

- `useQueries` ê²°ê³¼ ë°ì´í„°ë¥¼ ë‹¨ì¼ ê°’ìœ¼ë¡œ ê²°í•©í•˜ë ¤ë©´ `combine` ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

```tsx
const ids = [1,2,3]
const combinedQueries = useQueries({
  queries: ids.map(id => (
    { queryKey: ['post', id], queryFn: () => fetchPost(id) },
  )),
  combine: (results) => {
    return ({
      data: results.map(result => result.data),
      pending: results.some(result => result.isPending),
    })
  }
})
```

- ìœ„ ì˜ˆì œì—ì„œëŠ” `combinedQueries`ëŠ” `data`ì™€ `pending` ì†ì„±ì´ ìˆëŠ” ê°ì²´ê°€ ë©ë‹ˆë‹¤. ì¿¼ë¦¬ ê²°ê³¼ì˜ ë‹¤ë¥¸ ëª¨ë“  ì†ì„±ì€ ì†ì‹¤ëœë‹¤ëŠ” ì ì„ ì£¼ì˜í•´ì•¼ ë©ë‹ˆë‹¤.

<br />

### â€‹21. â­ï¸ new hooks for suspense

- v5ì—ì„œëŠ” `data fetching`ì— ëŒ€í•œ `suspense`ê°€ ë§ˆì¹¨ë‚´ ì•ˆì •í™”ë˜ì—ˆìŠµë‹ˆë‹¤.
- `useSuspenseQuery`, `useSuspenseInfiniteQuery`, `useSuspenseQueries` 3ê°€ì§€ í›…ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.
- ìœ„ 3ê°€ì§€ í›…ì„ ì‚¬ìš©í•˜ê²Œ ë˜ë©´ íƒ€ì… ë ˆë²¨ì—ì„œ `data`ê°€ `undefined` ìƒíƒœê°€ ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

```tsx
import { useSuspenseQuery } from "@tanstack/react-query";

const { data } = useSuspenseQuery({ queryKey, queryFn });
```

- suspenseì™€ ê´€ë ¨ëœ ìì„¸í•œ ë‚´ìš©ì€ [suspense](https://tanstack.com/query/v5/docs/react/guides/suspense)ë¥¼ ì°¸ê³ í•´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

<br />

### 22. â­ï¸ The minimum required TypeScript version is now 4.7

- Tanstack Query v5ëŠ” í•„ìš”í•œ TypeScript ìµœì†Œ ë²„ì „ì´ `v4.7`ì…ë‹ˆë‹¤.

<br />

### 23. â­ï¸ The minimum required React version is now 18.0

- Tanstack Query v5ëŠ” í•„ìš”í•œ React ìµœì†Œ ë²„ì „ì´ `v18.0`ì…ë‹ˆë‹¤. ì´ëŠ” React v18 ì´ìƒì—ì„œë§Œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” `useSyncExternalStore` í›…ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

<br />

### 24. â­ï¸ Supported Browsers

```
Chrome >= 91
Firefox >= 90
Edge >= 91
Safari >= 15
iOS >= 15
opera >= 77
```
