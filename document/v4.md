# ğŸ’» React-query v4

![á„‰á…³á„á…³á„…á…µá†«á„‰á…£á†º 2022-08-17 á„‹á…©á„’á…® 2 20 01](https://user-images.githubusercontent.com/64779472/185040681-2352e8c8-b2d7-40f7-893d-3ee2270904c9.png)

- react-query v4ê°€ ì •ì‹ ë¦´ë¦¬ì¦ˆë˜ë©´ì„œ v3ì™€ ë¹„êµí•´ì„œ ì£¼ìš” ë³€ê²½ì‚¬í•­ ì •ë¦¬ ë¬¸ì„œì…ë‹ˆë‹¤.
- ì¶”ê°€ ë‚´ìš©ì´ í•„ìš”í•˜ì‹ ë¶„ì€ ì–¸ì œë“  `issue`, `pull request` ë³´ë‚´ì£¼ì‹œê¸¸ ë°”ëë‹ˆë‹¤.

<br />

## ğŸ“ƒ ì£¼ìš” ë³€ê²½ ì‚¬í•­

### @tanstack/react-query

- v4ë¶€í„° react-queryì—ì„œ `@tanstack/react-query`ë¡œ íŒ¨í‚¤ì§€ê°€ ë³€ê²½ë˜ì—ˆë‹¤. ë”°ë¼ì„œ ì„¤ì¹˜ì™€ import í•  ë•Œ ì£¼ì˜í•´ì•¼ í•œë‹¤.

```
npm i @tanstack/react-query
or
yarn add @tanstack/react-query
```

```js
// v3
import { useQuery } from "react-query"; // (-)
import { ReactQueryDevtools } from "react-query/devtools"; // (-)

// v4
import { useQuery } from "@tanstack/react-query"; // (+)
import { ReactQueryDevtools } from "@tanstack/react-query-devtools"; // (+)
```

<br />

### ì¿¼ë¦¬ í‚¤ëŠ” ë°°ì—´ë¡œ í†µì¼

- v3ì—ì„œëŠ” queryKeyë¥¼ ë¬¸ìì—´ ë˜ëŠ” ë°°ì—´ë¡œ ì§€ì •í•  ìˆ˜ ìˆì—ˆë‹¤. ë¬¸ìì—´ê³¼ ë°°ì—´ ëª¨ë‘ ì‚¬ìš©í•  ìˆ˜ ìˆì—ˆëŠ”ë° ì‚¬ì‹¤ React QueryëŠ” ë‚´ë¶€ì ìœ¼ë¡œëŠ” í•­ìƒ Array Keysë¡œë§Œ ì‘ë™í–ˆì—ˆë‹¤. ê·¸ë¦¬ê³  ì´ë¥¼ v4ì—ì„œëŠ” ë°°ì—´ë¡œ í†µì¼ì‹œí‚¨ë‹¤.

```js
// v3
useQuery("todos", fetchTodos); // (-)

// v4
useQuery(["todos"], fetchTodos); // (+)
```

<br />

### status idle ìƒíƒœ ì œê±°

- v4ë¶€í„° ë” ë‚˜ì€ ì˜¤í”„ë¼ì¸ ì§€ì›ì„ìœ„í•œ fetchStatusê°€ ë„ì…ë˜ë©´ì„œ ê¸°ì¡´ì˜ `idle`ê°€ ë¬´ì˜ë¯¸í•´ ì¡ŒìŠµë‹ˆë‹¤. fetchStatusì— ëŒ€í•œ ë‚´ìš©ì€ ì•„ë˜ ì‚¬ì´íŠ¸ ì°¸ê³ 
- [FetchStatus](https://tanstack.com/query/v4/docs/guides/queries#why-two-different-states)

```js
status: "idle"; // (-)

status: "loading"; // (+)
fetchStatus: "idle"; // (+)
```

<br />

### useQueries

- v4ë¶€í„° `useQueries`ëŠ” ì¸ìë¡œ `queries` í”„ë¡œí¼í‹°ë¥¼ ê°€ì§„ ê°ì²´ë¥¼ ë„˜ê²¨ì¤„ ìˆ˜ ìˆë‹¤.
- `queries`ì˜ ê°’ì€ ì¿¼ë¦¬ ë°°ì—´ì¸ë° ì´ëŠ” v3ì—ì„œ useQueriesì—ê²Œ ë„˜ê²¨ì£¼ë˜ ì¿¼ë¦¬ ë°°ì—´ê³¼ ë™ì¼í•˜ë‹¤.

```js
// v3
useQueries([
  { queryKey1, queryFn1, options1 },
  { queryKey2, queryFn2, options2 },
]);

// v4
useQueries({
  queries: [
    { queryKey1, queryFn1, options1 },
    { queryKey2, queryFn2, options2 },
  ],
});
```

### networkMode

- ê¸°ë³¸ì ìœ¼ë¡œ react-queryëŠ” promiseë¥¼ ë°˜í™˜í•˜ëŠ” ëª¨ë“  ê²ƒì— ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ë¹„ë™ê¸° ìƒíƒœ ê´€ë¦¬ ë¼ì´ë¸ŒëŸ¬ë¦¬ì´ë©°, ì´ëŠ” axiosì™€ ê°™ì€ data fetching ë¼ì´ë¸ŒëŸ¬ë¦¬ì™€ ê°€ì¥ ë§ì´ ì‚¬ìš©ë˜ì–´ì§„ë‹¤.
- ê·¸ë ‡ê¸° ë•Œë¬¸ì— ë„¤íŠ¸ì›Œí¬ ì—°ê²°ì´ ì—†ëŠ” ê²½ìš° ê¸°ë³¸ì ìœ¼ë¡œ queryì™€ mutationì´ ì¼ì‹œì¤‘ì§€ ëœë‹¤. ì´ë•Œ, ì´ì „ ë™ì‘ì„ ì‹¤í–‰í•˜ë ¤ë©´ `networkMode`ë¥¼ ì„¤ì •í•´ì£¼ë©´ ëœë‹¤.

```js
new QueryClient({
  defaultOptions: {
    queries: {
      networkMode: "offlineFirst", // (+)
    },
    mutations: {
      networkmode: "offlineFirst", // (+)
    },
  },
});
```

<br />

### React18 ì§€ì›

- v4ëŠ” `React18`ì—ëŒ€í•œ ìµœê³  ìˆ˜ì¤€ì˜ ì§€ì›ê³¼ í•¨ê»˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ ì œê³µí•œë‹¤.

<br />

### íƒ€ì…ìŠ¤í¬ë¦½íŠ¸

- v4ëŠ” TypeScript `v4.1` ì´ìƒì„ ìš”êµ¬í•œë‹¤.

<br />

### (ì¶”ê°€ ì˜ˆì •ì…ë‹ˆë‹¤.)
